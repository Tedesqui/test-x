<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title data-i18n="appTitle">CorreÃ§Ã£o de Prova com IA</title>
    <style>
        body, html { margin: 0; padding: 0; font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif; background: black; color: white; overflow: hidden; }
        video, canvas { position: absolute; top: 0; left: 0; width: 100vw; height: 100vh; object-fit: cover; z-index: 0; }
        canvas { display: none; }
        #ui-container { position: fixed; bottom: 0; left: 0; width: 100%; z-index: 2; }
        #controls { display: flex; gap: 15px; justify-content: center; align-items: center; padding: 20px; background: linear-gradient(to top, rgba(0,0,0,0.7), rgba(0,0,0,0)); }
        button { padding: 12px 20px; font-size: 16px; font-weight: bold; background-color: #007bff; color: white; border: none; border-radius: 8px; cursor: pointer; transition: all 0.2s; display: flex; align-items: center; gap: 8px; box-shadow: 0 4px 12px rgba(0,0,0,0.3); }
        button:hover:not(:disabled) { background-color: #0056b3; }
        button:disabled { background: #555; cursor: not-allowed; }
        #output-panel { background: rgba(0,0,0,0.9); padding: 15px; max-height: 85vh; overflow-y: auto; box-sizing: border-box; border-top: 1px solid #444; }
        #access-timer { position: fixed; top: 10px; right: 10px; background: rgba(0, 0, 0, 0.6); backdrop-filter: blur(5px); color: white; padding: 8px 12px; border-radius: 8px; font-size: 0.9em; z-index: 10; border: 1px solid #444; }
    </style>
</head>
<body>
    <div id="main-app">
        <video id="video" autoplay playsinline muted></video>
        <canvas id="canvas"></canvas>
        <div id="ui-container">
            <div id="controls">
                <button id="zoomBtn">ğŸ” Zoom: 1x</button>
                <button id="captureBtn" data-i18n="captureButton">ğŸ“· Clique para Corrigir</button>
            </div>
            <div id="output-panel"><div id="status-text" data-i18n="statusInitial">ğŸ“· Aponte a cÃ¢mera para o texto e capture.</div></div>
        </div>
    </div>
    <div id="access-timer">
        <span data-i18n="timerLabel">Tempo Restante</span>: <span id="time-left">--s</span>
    </div>

    <script>
        const translations = {
            "pt-br": { appTitle: "CorreÃ§Ã£o de Prova com IA", captureButton: "ğŸ“· Clique para Corrigir", statusInitial: "ğŸ“· Aponte a cÃ¢mera para o texto e capture.", timerLabel: "Tempo Restante", sessionExpiredAlert: "Sua sessÃ£o de 1 semana expirou. Por favor, pague novamente.", statusReading: "ğŸ§  Lendo o texto da imagem...", statusProcessing: "ğŸ¤– Processando com a IA...", statusErrorCamera: "âŒ Erro ao acessar a cÃ¢mera.", statusErrorOcr: "âŒ Erro ao ler o texto: ", statusErrorApi: "âŒ Erro na API: ", confirmPrompt: "<strong>Revise o texto extraÃ­do e clique para obter a resposta:</strong>", retryButton: "Capturar Novamente", getAnswerButton: "Obter Resposta", emptyTextAlert: "O campo de texto nÃ£o pode estar vazio.", resultTitle: "âœ… Resultado" },
            "en": { appTitle: "AI Proofreader", captureButton: "ğŸ“· Click to Correct", statusInitial: "ğŸ“· Point the camera at the text and capture.", timerLabel: "Time Left", sessionExpiredAlert: "Your 1-week session has expired. Please pay again.", statusReading: "ğŸ§  Reading text from image...", statusProcessing: "ğŸ¤– Processing with AI...", statusErrorCamera: "âŒ Error accessing the camera.", statusErrorOcr: "âŒ Error reading text: ", statusErrorApi: "âŒ API Error: ", confirmPrompt: "<strong>Review the extracted text and click to get the answer:</strong>", retryButton: "Capture Again", getAnswerButton: "Get Answer", emptyTextAlert: "The text field cannot be empty.", resultTitle: "âœ… Result" },
            "es": { appTitle: "Corrector de Pruebas con IA", captureButton: "ğŸ“· Haga Clic para Corregir", statusInitial: "ğŸ“· Apunte la cÃ¡mara al texto y capture.", timerLabel: "Tiempo Restante", sessionExpiredAlert: "Su sesiÃ³n de 1 semana ha expirado. Por favor, pague de nuevo.", statusReading: "ğŸ§  Leyendo el texto de la imagen...", statusProcessing: "ğŸ¤– Procesando con IA...", statusErrorCamera: "âŒ Error al acceder a la cÃ¡mara.", statusErrorOcr: "âŒ Error al leer el texto: ", statusErrorApi: "âŒ Error de API: ", confirmPrompt: "<strong>Revise el texto extraÃ­do y haga clic para obtener la respuesta:</strong>", retryButton: "Capturar de Nuevo", getAnswerButton: "Obtener Respuesta", emptyTextAlert: "El campo de texto no puede estar vacÃ­o.", resultTitle: "âœ… Resultado" },
            "it": { appTitle: "Correttore di Bozze AI", captureButton: "ğŸ“· Clicca per Correggere", statusInitial: "ğŸ“· Punta la fotocamera sul testo e cattura.", timerLabel: "Tempo Rimanente", sessionExpiredAlert: "La tua sessione di 1 settimana Ã¨ scaduta. Per favore, paga di nuovo.", statusReading: "ğŸ§  Lettura del testo dall'immagine...", statusProcessing: "ğŸ¤– Elaborazione con IA...", statusErrorCamera: "âŒ Errore nell'accesso alla fotocamera.", statusErrorOcr: "âŒ Errore nella lettura del testo: ", statusErrorApi: "âŒ Errore API: ", confirmPrompt: "<strong>Rivedi il testo estratto e clicca per ottenere la risposta:</strong>", retryButton: "Cattura di Nuovo", getAnswerButton: "Ottieni Risposta", emptyTextAlert: "Il campo di testo non puÃ² essere vuoto.", resultTitle: "âœ… Risultato" },
            "fr": { appTitle: "Correcteur IA", captureButton: "ğŸ“· Cliquer pour Corriger", statusInitial: "ğŸ“· Pointez la camÃ©ra sur le texte et capturez.", timerLabel: "Temps Restant", sessionExpiredAlert: "Votre session d'une semaine a expirÃ©. Veuillez payer Ã  nouveau.", statusReading: "ğŸ§  Lecture du texte de l'image...", statusProcessing: "ğŸ¤– Traitement par l'IA...", statusErrorCamera: "âŒ Erreur d'accÃ¨s Ã  la camÃ©ra.", statusErrorOcr: "âŒ Erreur de lecture du texte: ", statusErrorApi: "âŒ Erreur d'API: ", confirmPrompt: "<strong>RÃ©visez le texte extrait et cliquez pour obtenir la rÃ©ponse:</strong>", retryButton: "Capturer Ã  Nouveau", getAnswerButton: "Obtenir la RÃ©ponse", emptyTextAlert: "Le champ de texte ne peut pas Ãªtre vide.", resultTitle: "âœ… RÃ©sultat" },
            "de": { appTitle: "KI-Korrektor", captureButton: "ğŸ“· Klicken zum Korrigieren", statusInitial: "ğŸ“· Richten Sie die Kamera auf den Text und erfassen Sie ihn.", timerLabel: "Verbleibende Zeit", sessionExpiredAlert: "Ihre 1-wÃ¶chige Sitzung ist abgelaufen. Bitte zahlen Sie erneut.", statusReading: "ğŸ§  Text aus Bild wird gelesen...", statusProcessing: "ğŸ¤– Verarbeitung mit KI...", statusErrorCamera: "âŒ Fehler beim Zugriff auf die Kamera.", statusErrorOcr: "âŒ Fehler beim Lesen des Textes: ", statusErrorApi: "âŒ API-Fehler: ", confirmPrompt: "<strong>ÃœberprÃ¼fen Sie den extrahierten Text und klicken Sie, um die Antwort zu erhalten:</strong>", retryButton: "Erneut erfassen", getAnswerButton: "Antwort erhalten", emptyTextAlert: "Das Textfeld darf nicht leer sein.", resultTitle: "âœ… Ergebnis" },
            "ru": { appTitle: "Ğ˜Ğ˜-ĞºĞ¾Ñ€Ñ€ĞµĞºÑ‚Ğ¾Ñ€", captureButton: "ğŸ“· ĞĞ°Ğ¶Ğ¼Ğ¸Ñ‚Ğµ, Ñ‡Ñ‚Ğ¾Ğ±Ñ‹ Ğ¸ÑĞ¿Ñ€Ğ°Ğ²Ğ¸Ñ‚ÑŒ", statusInitial: "ğŸ“· ĞĞ°Ğ²ĞµĞ´Ğ¸Ñ‚Ğµ ĞºĞ°Ğ¼ĞµÑ€Ñƒ Ğ½Ğ° Ñ‚ĞµĞºÑÑ‚ Ğ¸ ÑĞ´ĞµĞ»Ğ°Ğ¹Ñ‚Ğµ ÑĞ½Ğ¸Ğ¼Ğ¾Ğº.", timerLabel: "ĞÑÑ‚Ğ°Ğ»Ğ¾ÑÑŒ Ğ²Ñ€ĞµĞ¼ĞµĞ½Ğ¸", sessionExpiredAlert: "Ğ’Ğ°ÑˆĞ° Ğ½ĞµĞ´ĞµĞ»ÑŒĞ½Ğ°Ñ ÑĞµÑÑĞ¸Ñ Ğ¸ÑÑ‚ĞµĞºĞ»Ğ°. ĞŸĞ¾Ğ¶Ğ°Ğ»ÑƒĞ¹ÑÑ‚Ğ°, Ğ¾Ğ¿Ğ»Ğ°Ñ‚Ğ¸Ñ‚Ğµ ÑĞ½Ğ¾Ğ²Ğ°.", statusReading: "ğŸ§  Ğ§Ñ‚ĞµĞ½Ğ¸Ğµ Ñ‚ĞµĞºÑÑ‚Ğ° Ñ Ğ¸Ğ·Ğ¾Ğ±Ñ€Ğ°Ğ¶ĞµĞ½Ğ¸Ñ...", statusProcessing: "ğŸ¤– ĞĞ±Ñ€Ğ°Ğ±Ğ¾Ñ‚ĞºĞ° Ñ Ğ¿Ğ¾Ğ¼Ğ¾Ñ‰ÑŒÑ Ğ˜Ğ˜...", statusErrorCamera: "âŒ ĞÑˆĞ¸Ğ±ĞºĞ° Ğ´Ğ¾ÑÑ‚ÑƒĞ¿Ğ° Ğº ĞºĞ°Ğ¼ĞµÑ€Ğµ.", statusErrorOcr: "âŒ ĞÑˆĞ¸Ğ±ĞºĞ° Ñ‡Ñ‚ĞµĞ½Ğ¸Ñ Ñ‚ĞµĞºÑÑ‚Ğ°: ", statusErrorApi: "âŒ ĞÑˆĞ¸Ğ±ĞºĞ° API: ", confirmPrompt: "<strong>ĞŸÑ€Ğ¾ÑĞ¼Ğ¾Ñ‚Ñ€Ğ¸Ñ‚Ğµ Ğ¸Ğ·Ğ²Ğ»ĞµÑ‡ĞµĞ½Ğ½Ñ‹Ğ¹ Ñ‚ĞµĞºÑÑ‚ Ğ¸ Ğ½Ğ°Ğ¶Ğ¼Ğ¸Ñ‚Ğµ, Ñ‡Ñ‚Ğ¾Ğ±Ñ‹ Ğ¿Ğ¾Ğ»ÑƒÑ‡Ğ¸Ñ‚ÑŒ Ğ¾Ñ‚Ğ²ĞµÑ‚:</strong>", retryButton: "Ğ¡Ğ´ĞµĞ»Ğ°Ñ‚ÑŒ ÑĞ½Ğ¸Ğ¼Ğ¾Ğº ÑĞ½Ğ¾Ğ²Ğ°", getAnswerButton: "ĞŸĞ¾Ğ»ÑƒÑ‡Ğ¸Ñ‚ÑŒ Ğ¾Ñ‚Ğ²ĞµÑ‚", emptyTextAlert: "Ğ¢ĞµĞºÑÑ‚Ğ¾Ğ²Ğ¾Ğµ Ğ¿Ğ¾Ğ»Ğµ Ğ½Ğµ Ğ¼Ğ¾Ğ¶ĞµÑ‚ Ğ±Ñ‹Ñ‚ÑŒ Ğ¿ÑƒÑÑ‚Ñ‹Ğ¼.", resultTitle: "âœ… Ğ ĞµĞ·ÑƒĞ»ÑŒÑ‚Ğ°Ñ‚" },
            "ja": { appTitle: "AIæ ¡æ­£ãƒ„ãƒ¼ãƒ«", captureButton: "ğŸ“· ã‚¯ãƒªãƒƒã‚¯ã—ã¦ä¿®æ­£", statusInitial: "ğŸ“· ãƒ†ã‚­ã‚¹ãƒˆã«ã‚«ãƒ¡ãƒ©ã‚’å‘ã‘ã¦ã‚­ãƒ£ãƒ—ãƒãƒ£ã—ã¦ãã ã•ã„ã€‚", timerLabel: "æ®‹ã‚Šæ™‚é–“", sessionExpiredAlert: "1é€±é–“ã®ã‚»ãƒƒã‚·ãƒ§ãƒ³ãŒæœŸé™åˆ‡ã‚Œã«ãªã‚Šã¾ã—ãŸã€‚ã‚‚ã†ä¸€åº¦ãŠæ”¯æ‰•ã„ãã ã•ã„ã€‚", statusReading: "ğŸ§  ç”»åƒã‹ã‚‰ãƒ†ã‚­ã‚¹ãƒˆã‚’èª­ã¿è¾¼ã‚“ã§ã„ã¾ã™...", statusProcessing: "ğŸ¤– AIã§å‡¦ç†ä¸­...", statusErrorCamera: "âŒ ã‚«ãƒ¡ãƒ©ã¸ã®ã‚¢ã‚¯ã‚»ã‚¹ã‚¨ãƒ©ãƒ¼ã€‚", statusErrorOcr: "âŒ ãƒ†ã‚­ã‚¹ãƒˆã®èª­ã¿å–ã‚Šã‚¨ãƒ©ãƒ¼: ", statusErrorApi: "âŒ APIã‚¨ãƒ©ãƒ¼: ", confirmPrompt: "<strong>æŠ½å‡ºã•ã‚ŒãŸãƒ†ã‚­ã‚¹ãƒˆã‚’ç¢ºèªã—ã€ã‚¯ãƒªãƒƒã‚¯ã—ã¦å›ç­”ã‚’å¾—ã¦ãã ã•ã„:</strong>", retryButton: "å†ã‚­ãƒ£ãƒ—ãƒãƒ£", getAnswerButton: "å›ç­”ã‚’å¾—ã‚‹", emptyTextAlert: "ãƒ†ã‚­ã‚¹ãƒˆãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã¯ç©ºã«ã§ãã¾ã›ã‚“ã€‚", resultTitle: "âœ… çµæœ" },
            "ko": { appTitle: "AI êµì •ê¸°", captureButton: "ğŸ“· í´ë¦­í•˜ì—¬ ìˆ˜ì •", statusInitial: "ğŸ“· í…ìŠ¤íŠ¸ì— ì¹´ë©”ë¼ë¥¼ ë§ì¶”ê³  ìº¡ì²˜í•˜ì„¸ìš”.", timerLabel: "ë‚¨ì€ ì‹œê°„", sessionExpiredAlert: "1ì£¼ì¼ ì„¸ì…˜ì´ ë§Œë£Œë˜ì—ˆìŠµë‹ˆë‹¤. ë‹¤ì‹œ ê²°ì œí•´ ì£¼ì„¸ìš”.", statusReading: "ğŸ§  ì´ë¯¸ì§€ì—ì„œ í…ìŠ¤íŠ¸ ì½ëŠ” ì¤‘...", statusProcessing: "ğŸ¤– AIë¡œ ì²˜ë¦¬ ì¤‘...", statusErrorCamera: "âŒ ì¹´ë©”ë¼ ì•¡ì„¸ìŠ¤ ì˜¤ë¥˜.", statusErrorOcr: "âŒ í…ìŠ¤íŠ¸ ì½ê¸° ì˜¤ë¥˜: ", statusErrorApi: "âŒ API ì˜¤ë¥˜: ", confirmPrompt: "<strong>ì¶”ì¶œëœ í…ìŠ¤íŠ¸ë¥¼ ê²€í† í•˜ê³  í´ë¦­í•˜ì—¬ ë‹µë³€ì„ ì–»ìœ¼ì„¸ìš”:</strong>", retryButton: "ë‹¤ì‹œ ìº¡ì²˜", getAnswerButton: "ë‹µë³€ ì–»ê¸°", emptyTextAlert: "í…ìŠ¤íŠ¸ í•„ë“œëŠ” ë¹„ì›Œ ë‘˜ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.", resultTitle: "âœ… ê²°ê³¼" },
            "zh": { appTitle: "äººå·¥æ™ºèƒ½æ ¡å¯¹å™¨", captureButton: "ğŸ“· ç‚¹å‡»ä»¥æ›´æ­£", statusInitial: "ğŸ“· å°†ç›¸æœºå¯¹å‡†æ–‡æœ¬å¹¶æ•è·ã€‚", timerLabel: "å‰©ä½™æ—¶é—´", sessionExpiredAlert: "æ‚¨çš„1å‘¨ä¼šè¯å·²è¿‡æœŸã€‚è¯·é‡æ–°ä»˜æ¬¾ã€‚", statusReading: "ğŸ§  æ­£åœ¨ä»å›¾åƒä¸­è¯»å–æ–‡æœ¬...", statusProcessing: "ğŸ¤– æ­£åœ¨ä½¿ç”¨AIå¤„ç†...", statusErrorCamera: "âŒ è®¿é—®ç›¸æœºæ—¶å‡ºé”™ã€‚", statusErrorOcr: "âŒ è¯»å–æ–‡æœ¬æ—¶å‡ºé”™: ", statusErrorApi: "âŒ APIé”™è¯¯: ", confirmPrompt: "<strong>æŸ¥çœ‹æå–çš„æ–‡æœ¬å¹¶ç‚¹å‡»ä»¥è·å–ç­”æ¡ˆï¼š</strong>", retryButton: "é‡æ–°æ•è·", getAnswerButton: "è·å–ç­”æ¡ˆ", emptyTextAlert: "æ–‡æœ¬å­—æ®µä¸èƒ½ä¸ºç©ºã€‚", resultTitle: "âœ… ç»“æœ" },
            "hi": { appTitle: "à¤à¤†à¤ˆ à¤ªà¥à¤°à¥‚à¤«à¤¼à¤°à¥€à¤¡à¤°", captureButton: "ğŸ“· à¤¸à¤¹à¥€ à¤•à¤°à¤¨à¥‡ à¤•à¥‡ à¤²à¤¿à¤ à¤•à¥à¤²à¤¿à¤• à¤•à¤°à¥‡à¤‚", statusInitial: "ğŸ“· à¤•à¥ˆà¤®à¤°à¥‡ à¤•à¥‹ à¤Ÿà¥‡à¤•à¥à¤¸à¥à¤Ÿ à¤ªà¤° à¤‡à¤‚à¤—à¤¿à¤¤ à¤•à¤°à¥‡à¤‚ à¤”à¤° à¤•à¥ˆà¤ªà¥à¤šà¤° à¤•à¤°à¥‡à¤‚à¥¤", timerLabel: "à¤¶à¥‡à¤· à¤¸à¤®à¤¯", sessionExpiredAlert: "à¤†à¤ªà¤•à¤¾ 1-à¤¸à¤ªà¥à¤¤à¤¾à¤¹ à¤•à¤¾ à¤¸à¤¤à¥à¤° à¤¸à¤®à¤¾à¤ªà¥à¤¤ à¤¹à¥‹ à¤—à¤¯à¤¾ à¤¹à¥ˆà¥¤ à¤•à¥ƒà¤ªà¤¯à¤¾ à¤ªà¥à¤¨à¤ƒ à¤­à¥à¤—à¤¤à¤¾à¤¨ à¤•à¤°à¥‡à¤‚à¥¤", statusReading: "ğŸ§  à¤›à¤µà¤¿ à¤¸à¥‡ à¤ªà¤¾à¤  à¤ªà¤¢à¤¼à¤¾ à¤œà¤¾ à¤°à¤¹à¤¾ à¤¹à¥ˆ...", statusProcessing: "ğŸ¤– à¤à¤†à¤ˆ à¤•à¥‡ à¤¸à¤¾à¤¥ à¤ªà¥à¤°à¤¸à¤‚à¤¸à¥à¤•à¤°à¤£...", statusErrorCamera: "âŒ à¤•à¥ˆà¤®à¤°à¥‡ à¤¤à¤• à¤ªà¤¹à¥à¤‚à¤šà¤¨à¥‡ à¤®à¥‡à¤‚ à¤¤à¥à¤°à¥à¤Ÿà¤¿à¥¤", statusErrorOcr: "âŒ à¤ªà¤¾à¤  à¤ªà¤¢à¤¼à¤¨à¥‡ à¤®à¥‡à¤‚ à¤¤à¥à¤°à¥à¤Ÿà¤¿: ", statusErrorApi: "âŒ à¤à¤ªà¥€à¤†à¤ˆ à¤¤à¥à¤°à¥à¤Ÿà¤¿: ", confirmPrompt: "<strong>à¤¨à¤¿à¤•à¤¾à¤²à¥‡ à¤—à¤ à¤ªà¤¾à¤  à¤•à¥€ à¤¸à¤®à¥€à¤•à¥à¤·à¤¾ à¤•à¤°à¥‡à¤‚ à¤”à¤° à¤‰à¤¤à¥à¤¤à¤° à¤ªà¥à¤°à¤¾à¤ªà¥à¤¤ à¤•à¤°à¤¨à¥‡ à¤•à¥‡ à¤²à¤¿à¤ à¤•à¥à¤²à¤¿à¤• à¤•à¤°à¥‡à¤‚:</strong>", retryButton: "à¤ªà¥à¤¨à¤ƒ à¤•à¥ˆà¤ªà¥à¤šà¤° à¤•à¤°à¥‡à¤‚", getAnswerButton: "à¤‰à¤¤à¥à¤¤à¤° à¤ªà¥à¤°à¤¾à¤ªà¥à¤¤ à¤•à¤°à¥‡à¤‚", emptyTextAlert: "à¤ªà¤¾à¤  à¤•à¥à¤·à¥‡à¤¤à¥à¤° à¤–à¤¾à¤²à¥€ à¤¨à¤¹à¥€à¤‚ à¤¹à¥‹ à¤¸à¤•à¤¤à¤¾à¥¤", resultTitle: "âœ… à¤ªà¤°à¤¿à¤£à¤¾à¤®" },
            "fil": { appTitle: "AI Proofreader", captureButton: "ğŸ“· I-click para Itama", statusInitial: "ğŸ“· Itutok ang camera sa teksto at kunan.", timerLabel: "Natitirang Oras", sessionExpiredAlert: "Nag-expire na ang iyong 1-linggong session. Mangyaring magbayad muli.", statusReading: "ğŸ§  Binabasa ang teksto mula sa imahe...", statusProcessing: "ğŸ¤– Pinoproseso gamit ang AI...", statusErrorCamera: "âŒ Error sa pag-access sa camera.", statusErrorOcr: "âŒ Error sa pagbasa ng teksto: ", statusErrorApi: "âŒ Error sa API: ", confirmPrompt: "<strong>Suriin ang nakuhang teksto at i-click para makuha ang sagot:</strong>", retryButton: "Kunan Muli", getAnswerButton: "Kumuha ng Sagot", emptyTextAlert: "Hindi maaaring walang laman ang text field.", resultTitle: "âœ… Resulta" },
            "sv": { appTitle: "AI-korrekturlÃ¤sare", captureButton: "ğŸ“· Klicka fÃ¶r att korrigera", statusInitial: "ğŸ“· Rikta kameran mot texten och fÃ¥nga.", timerLabel: "Tid kvar", sessionExpiredAlert: "Din 1-veckas session har gÃ¥tt ut. Betala igen.", statusReading: "ğŸ§  LÃ¤ser text frÃ¥n bild...", statusProcessing: "ğŸ¤– Bearbetar med AI...", statusErrorCamera: "âŒ Fel vid Ã¥tkomst till kameran.", statusErrorOcr: "âŒ Fel vid lÃ¤sning av text: ", statusErrorApi: "âŒ API-fel: ", confirmPrompt: "<strong>Granska den extraherade texten och klicka fÃ¶r att fÃ¥ svaret:</strong>", retryButton: "FÃ¥nga igen", getAnswerButton: "FÃ¥ svar", emptyTextAlert: "TextfÃ¤ltet fÃ¥r inte vara tomt.", resultTitle: "âœ… Resultat" },
            "pl": { appTitle: "Korektor AI", captureButton: "ğŸ“· Kliknij, aby poprawiÄ‡", statusInitial: "ğŸ“· Skieruj aparat na tekst i przechwyÄ‡.", timerLabel: "PozostaÅ‚y czas", sessionExpiredAlert: "Twoja 1-tygodniowa sesja wygasÅ‚a. ZapÅ‚aÄ‡ ponownie.", statusReading: "ğŸ§  Czytanie tekstu z obrazu...", statusProcessing: "ğŸ¤– Przetwarzanie za pomocÄ… AI...", statusErrorCamera: "âŒ BÅ‚Ä…d dostÄ™pu do kamery.", statusErrorOcr: "âŒ BÅ‚Ä…d odczytu tekstu: ", statusErrorApi: "âŒ BÅ‚Ä…d API: ", confirmPrompt: "<strong>Przejrzyj wyodrÄ™bniony tekst i kliknij, aby uzyskaÄ‡ odpowiedÅº:</strong>", retryButton: "PrzechwyÄ‡ ponownie", getAnswerButton: "Uzyskaj odpowiedÅº", emptyTextAlert: "Pole tekstowe nie moÅ¼e byÄ‡ puste.", resultTitle: "âœ… Wynik" },
            "bn": { appTitle: "à¦à¦†à¦‡ à¦ªà§à¦°à§à¦«à¦°à¦¿à¦¡à¦¾à¦°", captureButton: "ğŸ“· à¦¸à¦‚à¦¶à§‹à¦§à¦¨ à¦•à¦°à¦¤à§‡ à¦•à§à¦²à¦¿à¦• à¦•à¦°à§à¦¨", statusInitial: "ğŸ“· à¦Ÿà§‡à¦•à§à¦¸à¦Ÿà§‡à¦° à¦¦à¦¿à¦•à§‡ à¦•à§à¦¯à¦¾à¦®à§‡à¦°à¦¾ à¦¨à¦¿à¦°à§à¦¦à§‡à¦¶ à¦•à¦°à§à¦¨ à¦à¦¬à¦‚ à¦•à§à¦¯à¦¾à¦ªà¦šà¦¾à¦° à¦•à¦°à§à¦¨à¥¤", timerLabel: "à¦¬à¦¾à¦•à¦¿ à¦¸à¦®à¦¯à¦¼", sessionExpiredAlert: "à¦†à¦ªà¦¨à¦¾à¦° à§§ à¦¸à¦ªà§à¦¤à¦¾à¦¹à§‡à¦° à¦¸à§‡à¦¶à¦¨ à¦®à§‡à¦¯à¦¼à¦¾à¦¦à§‹à¦¤à§à¦¤à§€à¦°à§à¦£ à¦¹à¦¯à¦¼à§‡à¦›à§‡à¥¤ à¦…à¦¨à§à¦—à§à¦°à¦¹ à¦•à¦°à§‡ à¦†à¦¬à¦¾à¦° à¦…à¦°à§à¦¥à¦ªà§à¦°à¦¦à¦¾à¦¨ à¦•à¦°à§à¦¨à¥¤", statusReading: "ğŸ§  à¦›à¦¬à¦¿ à¦¥à§‡à¦•à§‡ à¦Ÿà§‡à¦•à§à¦¸à¦Ÿ à¦ªà¦¡à¦¼à¦¾ à¦¹à¦šà§à¦›à§‡...", statusProcessing: "ğŸ¤– à¦à¦†à¦‡ à¦¦à¦¿à¦¯à¦¼à§‡ à¦ªà§à¦°à¦¸à§‡à¦¸ à¦•à¦°à¦¾ à¦¹à¦šà§à¦›à§‡...", statusErrorCamera: "âŒ à¦•à§à¦¯à¦¾à¦®à§‡à¦°à¦¾ à¦…à§à¦¯à¦¾à¦•à§à¦¸à§‡à¦¸ à¦•à¦°à¦¤à§‡ à¦¤à§à¦°à§à¦Ÿà¦¿à¥¤", statusErrorOcr: "âŒ à¦Ÿà§‡à¦•à§à¦¸à¦Ÿ à¦ªà¦¡à¦¼à¦¤à§‡ à¦¤à§à¦°à§à¦Ÿà¦¿: ", statusErrorApi: "âŒ à¦à¦ªà¦¿à¦†à¦‡ à¦¤à§à¦°à§à¦Ÿà¦¿: ", confirmPrompt: "<strong>à¦¨à¦¿à¦·à§à¦•à¦¾à¦¶à¦¿à¦¤ à¦Ÿà§‡à¦•à§à¦¸à¦Ÿ à¦ªà¦°à§à¦¯à¦¾à¦²à§‹à¦šà¦¨à¦¾ à¦•à¦°à§à¦¨ à¦à¦¬à¦‚ à¦‰à¦¤à§à¦¤à¦° à¦ªà§‡à¦¤à§‡ à¦•à§à¦²à¦¿à¦• à¦•à¦°à§à¦¨:</strong>", retryButton: "à¦†à¦¬à¦¾à¦° à¦•à§à¦¯à¦¾à¦ªà¦šà¦¾à¦° à¦•à¦°à§à¦¨", getAnswerButton: "à¦‰à¦¤à§à¦¤à¦° à¦ªà¦¾à¦¨", emptyTextAlert: "à¦Ÿà§‡à¦•à§à¦¸à¦Ÿ à¦•à§à¦·à§‡à¦¤à§à¦°à¦Ÿà¦¿ à¦–à¦¾à¦²à¦¿ à¦°à¦¾à¦–à¦¾ à¦¯à¦¾à¦¬à§‡ à¦¨à¦¾à¥¤", resultTitle: "âœ… à¦«à¦²à¦¾à¦«à¦²" },
            "ar": { appTitle: "Ù…Ø¯Ù‚Ù‚ Ù„ØºÙˆÙŠ Ø¨Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø§ØµØ·Ù†Ø§Ø¹ÙŠ", captureButton: "ğŸ“· Ø§Ù†Ù‚Ø± Ù„Ù„ØªØµØ­ÙŠØ­", statusInitial: "ğŸ“· ÙˆØ¬Ù‡ Ø§Ù„ÙƒØ§Ù…ÙŠØ±Ø§ Ù†Ø­Ùˆ Ø§Ù„Ù†Øµ ÙˆØ§Ù„ØªÙ‚Ø·.", timerLabel: "Ø§Ù„ÙˆÙ‚Øª Ø§Ù„Ù…ØªØ¨Ù‚ÙŠ", sessionExpiredAlert: "Ø§Ù†ØªÙ‡Øª ØµÙ„Ø§Ø­ÙŠØ© Ø¬Ù„Ø³ØªÙƒ Ù„Ù…Ø¯Ø© Ø£Ø³Ø¨ÙˆØ¹. ÙŠØ±Ø¬Ù‰ Ø§Ù„Ø¯ÙØ¹ Ù…Ø±Ø© Ø£Ø®Ø±Ù‰.", statusReading: "ğŸ§  Ù‚Ø±Ø§Ø¡Ø© Ø§Ù„Ù†Øµ Ù…Ù† Ø§Ù„ØµÙˆØ±Ø©...", statusProcessing: "ğŸ¤– Ø§Ù„Ù…Ø¹Ø§Ù„Ø¬Ø© Ø¨Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø§ØµØ·Ù†Ø§Ø¹ÙŠ...", statusErrorCamera: "âŒ Ø®Ø·Ø£ ÙÙŠ Ø§Ù„ÙˆØµÙˆÙ„ Ø¥Ù„Ù‰ Ø§Ù„ÙƒØ§Ù…ÙŠØ±Ø§.", statusErrorOcr: "âŒ Ø®Ø·Ø£ ÙÙŠ Ù‚Ø±Ø§Ø¡Ø© Ø§Ù„Ù†Øµ: ", statusErrorApi: "âŒ Ø®Ø·Ø£ ÙÙŠ ÙˆØ§Ø¬Ù‡Ø© Ø¨Ø±Ù…Ø¬Ø© Ø§Ù„ØªØ·Ø¨ÙŠÙ‚Ø§Øª: ", confirmPrompt: "<strong>Ø±Ø§Ø¬Ø¹ Ø§Ù„Ù†Øµ Ø§Ù„Ù…Ø³ØªØ®Ø±Ø¬ ÙˆØ§Ù†Ù‚Ø± Ù„Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø©:</strong>", retryButton: "Ø§Ù„ØªÙ‚Ø§Ø· Ù…Ø±Ø© Ø£Ø®Ø±Ù‰", getAnswerButton: "Ø§Ø­ØµÙ„ Ø¹Ù„Ù‰ Ø¥Ø¬Ø§Ø¨Ø©", emptyTextAlert: "Ù„Ø§ ÙŠÙ…ÙƒÙ† Ø£Ù† ÙŠÙƒÙˆÙ† Ø­Ù‚Ù„ Ø§Ù„Ù†Øµ ÙØ§Ø±ØºÙ‹Ø§.", resultTitle: "âœ… Ù†ØªÙŠØ¬Ø©" }
        };
        
        const supportedLanguages = { "pt-br": true, "en": true, "es": true, "it": true, "fr": true, "ru": true, "ja": true, "ko": true, "zh": true, "de": true, "hi": true, "fil": true, "sv": true, "pl": true, "bn": true, "ar": true };
        const userLanguage = navigator.language || navigator.userLanguage;
        let langCode = 'en';
        const userLangLower = userLanguage.toLowerCase();
        if (supportedLanguages[userLangLower]) { langCode = userLangLower; }
        else { const primaryLang = userLangLower.split('-')[0]; if (supportedLanguages[primaryLang]) { langCode = primaryLang; } }
        
        const dictionary = translations[langCode] || translations['en'];

        document.documentElement.lang = userLanguage;
        document.querySelectorAll('[data-i18n]').forEach(element => {
            const key = element.getAttribute('data-i18n');
            if (dictionary[key]) { element.innerHTML = dictionary[key]; }
        });

        // --- LÃ“GICA DA APLICAÃ‡ÃƒO ---
        (function checkAccess() {
            const tokenString = localStorage.getItem('accessToken');
            if (!tokenString) { window.location.href = '/index.html'; return; }
            const token = JSON.parse(tokenString);
            if (Date.now() > token.expiry) {
                localStorage.removeItem('accessToken');
                alert(dictionary.sessionExpiredAlert);
                window.location.href = '/index.html';
            }
        })();

        const timerDisplay = document.getElementById('time-left');
        const tokenData = JSON.parse(localStorage.getItem('accessToken'));
        if (tokenData && timerDisplay) {
            const expiryTime = tokenData.expiry;
            const updateTimer = () => {
                const timeLeft = expiryTime - Date.now();
                if (timeLeft <= 0) { timerDisplay.textContent = 'Expirado'; clearInterval(timerInterval); window.location.reload(); return; }
                timerDisplay.textContent = `${Math.floor(timeLeft / 1000)}s`;
            };
            const timerInterval = setInterval(updateTimer, 1000);
            updateTimer();
        }

        const video = document.getElementById("video");
        const canvas = document.getElementById("canvas");
        const ctx = canvas.getContext("2d");
        const outputPanel = document.getElementById("output-panel");
        const controlsDiv = document.getElementById("controls");
        const zoomBtn = document.getElementById("zoomBtn");
        const captureBtn = document.getElementById("captureBtn");
        let mediaTrack, currentZoom = 1;
        const zoomLevels = [1, 1.5, 2, 3];
        async function startCamera() {
            try {
                const stream = await navigator.mediaDevices.getUserMedia({ video: { facingMode: { ideal: "environment" } } });
                video.srcObject = stream;
                mediaTrack = stream.getVideoTracks()[0];
                const capabilities = mediaTrack.getCapabilities();
                if (!capabilities.zoom || capabilities.zoom.max <= 1) { zoomBtn.style.display = 'none'; }
            } catch (err) { console.error("Erro ao iniciar a cÃ¢mera:", err.name, err.message); outputPanel.innerHTML = `<div id="status-text">${dictionary.statusErrorCamera}</div>`; }
        }
        function toggleZoom() { if (!mediaTrack || !mediaTrack.getCapabilities().zoom) return; const currentIndex = zoomLevels.indexOf(currentZoom); currentZoom = zoomLevels[(currentIndex + 1) % zoomLevels.length]; mediaTrack.applyConstraints({ advanced: [{ zoom: currentZoom }] }); zoomBtn.innerText = `ğŸ” Zoom: ${currentZoom}x`; }
        function resetUI() { canvas.style.display = 'none'; video.style.display = 'block'; outputPanel.innerHTML = `<div id="status-text">${dictionary.statusInitial}</div>`; controlsDiv.style.display = 'flex'; captureBtn.disabled = false; }
        async function captureAndRecognize() {
            captureBtn.disabled = true; canvas.width = video.videoWidth; canvas.height = video.videoHeight;
            ctx.drawImage(video, 0, 0, canvas.width, canvas.height);
            video.style.display = 'none'; canvas.style.display = 'block'; controlsDiv.style.display = 'none';
            outputPanel.innerHTML = `<div id="status-text">${dictionary.statusReading}</div>`;
            try {
                const response = await fetch("/api/read-text-aws", { method: "POST", headers: { "Content-Type": "application/json" }, body: JSON.stringify({ image: canvas.toDataURL('image/jpeg') }) });
                if (!response.ok) { const err = await response.json(); throw new Error(err.error || `Erro OCR`); }
                const data = await response.json(); showConfirmationView(data.text.trim());
            } catch (err) { console.error("Erro no OCR:", err); outputPanel.innerHTML = `<div id="status-text">${dictionary.statusErrorOcr}${err.message}</div>`; addRetryButton(resetUI); }
        }
        function showConfirmationView(ocrText) {
            outputPanel.innerHTML = `<div id="confirmation-view"><p>${dictionary.confirmPrompt}</p><textarea id="text-to-process">${ocrText}</textarea><div id="confirmation-controls"><button id="retryBtn" class="secondary">${dictionary.retryButton}</button><button id="sendBtn" class="confirm">${dictionary.getAnswerButton}</button></div></div>`;
            document.getElementById('retryBtn').addEventListener('click', resetUI);
            document.getElementById('sendBtn').addEventListener('click', sendForCorrection);
        }
        async function sendForCorrection() {
            const textToProcess = document.getElementById('text-to-process').value;
            if (!textToProcess.trim()) { alert(dictionary.emptyTextAlert); return; }
            outputPanel.innerHTML = `<div id="status-text">${dictionary.statusProcessing}</div>`;
            try {
                const response = await fetch("/api/corrigir", { method: "POST", headers: { "Content-Type": "application/json" }, body: JSON.stringify({ texto: textToProcess, language: langCode }) });
                if (!response.ok) { const err = await response.json(); throw new Error(err.error || `Erro API`); }
                const data = await response.json();
                outputPanel.innerHTML = `<h2>${dictionary.resultTitle}</h2><pre id="correction-result">${data.resultado}</pre>`;
            } catch (err) { console.error("Erro na requisiÃ§Ã£o:", err); outputPanel.innerHTML = `<div id="status-text">${dictionary.statusErrorApi}${err.message}</div>`; } finally { addRetryButton(resetUI); }
        }
        function addRetryButton(action) { const btn = document.createElement('button'); btn.innerText = dictionary.retryButton; btn.style.marginTop = '15px'; btn.addEventListener('click', action); outputPanel.appendChild(btn); }
        zoomBtn.addEventListener('click', toggleZoom);
        captureBtn.addEventListener('click', captureAndRecognize);
        startCamera();
    </script>
</body>
</html>
