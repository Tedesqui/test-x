<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title data-i18n="pageTitle">Receba as respostas das questÃµes da sua prova!!!</title>
    <style>
        body, html { margin: 0; padding: 0; font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif; background: #121212; color: white; }
        .hidden-on-load { visibility: hidden; }
        .container { display: flex; flex-direction: column; align-items: center; justify-content: center; min-height: 100vh; text-align: center; padding: 20px; box-sizing: border-box; }
        .view { display: none; flex-direction: column; align-items: center; width: 100%; max-width: 420px; margin-top: -250px; }
        .view.active { display: flex; }
        #start-btn { width: 100%; color: white; font-weight: bold; font-size: 18px; padding: 0.75rem 1rem; border: none; border-radius: 0.5rem; cursor: pointer; transition: background-color 0.2s; margin-top: 1.5rem; background-color: #22c55e; }
        #start-btn:hover:not(:disabled) { background-color: #16a34a; }
        #start-btn:disabled { background-color: #555; cursor: wait; }
    </style>
</head>
<body class="hidden-on-load">
    <div class="container">
        <div id="welcome-view" class="view active">
            <h2 data-i18n="headline">ðŸ”’ Acesso por 1 Semana Ã  CorreÃ§Ã£o de Provas</h2>
            <p data-i18n="subheadline" style="font-size: 1.1em; line-height: 1.5;">Realize o pagamento de <strong data-i18n="price">R$ 14,90</strong> para liberar o acesso...</p>
            <button id="start-btn" data-i18n="paymentButton">CLIQUE AQUI PARA PAGAR</button>
        </div>
    </div>

    <script>
        // O dicionÃ¡rio completo de traduÃ§Ãµes... (mantido como na versÃ£o anterior)
        const translations = { "pt-br": { pageTitle: "Receba as respostas...", headline: "ðŸ”’ Acesso por 1 Semana...", subheadline: 'Realize o pagamento...', price: 'R$ 14,90', paymentButton: "CLIQUE AQUI PARA PAGAR", loadingCheckout: "Aguarde, gerando checkout...", checkoutError: "Erro ao gerar link de pagamento.", paymentCheck: "Verificando seu pagamento...", paymentCheckError: "Ocorreu um problema..." }, "en": { pageTitle: "Get Answers...", headline: "ðŸ”’ 1-Week Access...", subheadline: 'Make the payment...', price: '$3.00 USD', paymentButton: "CLICK HERE TO PAY", loadingCheckout: "Please wait...", checkoutError: "Error generating link.", paymentCheck: "Verifying your payment...", paymentCheckError: "There was a problem..." }, /* ...outras linguagens... */ };

        function setLanguage(langCode, priceText) { /* ...funÃ§Ã£o mantida... */ }
        
        function main() {
            try {
                document.body.classList.remove('hidden-on-load');
                
                const APP_PAGE = "/app.html";
                function getSessionId() { let sid = localStorage.getItem("mp_session_id"); if (!sid) { sid = crypto.randomUUID(); localStorage.setItem("mp_session_id", sid); } return sid; }
                function hasValidAccess() { const t = localStorage.getItem('accessToken'); if (!t) return false; try { return Date.now() < JSON.parse(t).expiry; } catch (e) { return false; } }
                function setAccessAndRedirect() { const expiry = Date.now() + 604800000; localStorage.setItem("accessToken", JSON.stringify({ expiry })); window.location.href = APP_PAGE; }

                if (hasValidAccess()) {
                    window.location.href = APP_PAGE;
                    return;
                }

                const userLanguage = (navigator.language || navigator.userLanguage).toLowerCase();
                const isBrazilianPortuguese = userLanguage.startsWith('pt');
                const currency = isBrazilianPortuguese ? 'BRL' : 'USD';
                const langCode = isBrazilianPortuguese ? 'pt-br' : 'en';
                const dictionary = translations[langCode] || translations['en'];
                
                setLanguage(langCode, dictionary.price);

                document.getElementById('start-btn').addEventListener('click', async () => {
                    const btn = document.getElementById('start-btn');
                    btn.disabled = true;
                    btn.textContent = dictionary.loadingCheckout;
                    
                    const payload = { sessionId: getSessionId(), email: "cliente@email.com", currency };
                    console.log("Enviando para o backend:", payload); // Mantemos o log do console

                    try {
                        const res = await fetch("/api/create-payment", { method: "POST", headers: { "Content-Type": "application/json" }, body: JSON.stringify(payload) });
                        if (!res.ok) { const err = await res.json(); throw new Error(err.details || dictionary.checkoutError); }
                        const data = await res.json();
                        window.location.href = data.checkoutUrl;
                    } catch (error) {
                        alert(error.message);
                        btn.disabled = false;
                        btn.textContent = dictionary.paymentButton;
                    }
                });

                // LÃ³gica para verificar pagamento (mantida)
                const urlParams = new URLSearchParams(window.location.search);
                if (urlParams.has('success')) {
                    // ...
                }
            } catch (error) {
                // ...
            }
        }
        main();
    </script>
</body>
</html>
