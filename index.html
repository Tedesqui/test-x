<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Acesso  Ferramenta de Corre칞칚o com IA</title>
    <script src="https://sdk.mercadopago.com/js/v2"></script>
    <style>
        body, html { margin: 0; padding: 0; font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif; background: black; color: white; }
        .container { display: flex; flex-direction: column; align-items: center; justify-content: center; gap: 16px; height: 100vh; text-align: center; padding: 20px; box-sizing: border-box; }
        h2 { font-size: 1.8em; }
        p { font-size: 1.1em; line-height: 1.5; }
        #pay-btn { padding: 14px 22px; font-size: 18px; border-radius: 8px; border: none; background: #28a745; color: white; cursor: pointer; font-weight: bold; }
        #wallet_container { margin-top: 10px; width: 320px; max-width: 90%; }
    </style>
</head>
<body>

    <div class="container">
        <h2>游 Acesso Restrito  Ferramenta de Corre칞칚o</h2>
        <p>Para usar a ferramenta por <strong>1 hora</strong>, fa칞a o pagamento de <strong>R$ 1,00</strong>.</p>
        <button id="pay-btn">游눱 Pagar R$ 1,00 com Mercado Pago</button>
        <div id="wallet_container"></div>
        <p style="font-size:0.9em;color:#ccc;margin-top:8px">Pagamento seguro via cart칚o, PIX e boleto.</p>
    </div>

    <script>
        // --- CONFIGURA칂츾O ---
        const PUBLIC_KEY = "APP_USR-e86d8ca0-976c-468a-96ca-7e556120f5eb";
        const MP_SERVER_CREATE = "/api/create-payment";
        const APP_PAGE = "app.html"; // Nome da sua p치gina de aplica칞칚o

        // --- L칍GICA DE ACESSO ---
        function setAccessAndRedirect() {
            const expiry = Date.now() + (60 * 60 * 1000); // 1 hora de acesso
            const data = { expiry: expiry, grantedAt: Date.now() };
            // Usamos localStorage para persistir o acesso mesmo se a aba for fechada
            localStorage.setItem("accessToken", JSON.stringify(data));
            // Redireciona para a p치gina principal do app
            window.location.href = APP_PAGE;
        }

        // --- VERIFICA칂츾O P칍S-PAGAMENTO ---
        // Verifica se o usu치rio acabou de voltar de um pagamento bem-sucedido
        const params = new URLSearchParams(window.location.search);
        if (params.get("payment_status") === "success") {
            setAccessAndRedirect();
        }

        // --- L칍GICA DO BOT츾O DE PAGAMENTO ---
        const mp = new MercadoPago(PUBLIC_KEY, { locale: 'pt-BR' });
        
        document.getElementById("pay-btn").addEventListener("click", async () => {
            const payBtn = document.getElementById("pay-btn");
            payBtn.disabled = true;
            payBtn.textContent = "Aguarde...";

            try {
                const res = await fetch(MP_SERVER_CREATE, { method: "POST" });
                if (!res.ok) throw new Error("Erro ao iniciar o processo de pagamento.");
                
                const data = await res.json();
                
                // Abre o checkout do Mercado Pago, que redirecionar치 automaticamente
                mp.checkout({
                    preference: { id: data.preferenceId },
                    autoOpen: true,
                    render: { container: '#wallet_container' }
                });

            } catch (error) {
                alert(error.message);
                payBtn.disabled = false;
                payBtn.textContent = "游눱 Pagar R$ 1,00 com Mercado Pago";
            }
        });
    </script>
</body>
</html>
