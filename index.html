<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title data-i18n="pageTitle">Receba as respostas das questÃµes da sua prova!!!</title>
    <style>
        body, html { margin: 0; padding: 0; font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif; background: #121212; color: white; }
        .hidden-on-load { visibility: hidden; }
        .container { display: flex; flex-direction: column; align-items: center; justify-content: center; min-height: 100vh; text-align: center; padding: 20px; box-sizing: border-box; }
        .view { display: none; flex-direction: column; align-items: center; width: 100%; max-width: 420px; margin-top: -250px; }
        .view.active { display: flex; }
        #start-btn { width: 100%; color: white; font-weight: bold; font-size: 18px; padding: 0.75rem 1rem; border: none; border-radius: 0.5rem; cursor: pointer; transition: background-color 0.2s; margin-top: 1.5rem; background-color: #22c55e; }
        #start-btn:hover:not(:disabled) { background-color: #16a34a; }
        #start-btn:disabled { background-color: #555; cursor: wait; }
    </style>
</head>
<body class="hidden-on-load">
    <div class="container">
        <div id="welcome-view" class="view active">
            <h2 data-i18n="headline">ğŸ”’ Acesso por 1 Semana Ã  CorreÃ§Ã£o de Provas</h2>
            <p data-i18n="subheadline" style="font-size: 1.1em; line-height: 1.5;">Realize o pagamento de <strong data-i18n="price">R$ 14,90</strong> para liberar o acesso...</p>
            <button id="start-btn" data-i18n="paymentButton">CLIQUE AQUI PARA PAGAR</button>
        </div>
    </div>

    <script>
        // --- DICIONÃRIO DE TRADUÃ‡Ã•ES (i18n) COMPLETO ---
        const translations = {
            "pt-br": { pageTitle: "Receba as respostas das questÃµes da sua prova!!!", headline: "ğŸ”’ Acesso por 1 Semana Ã  CorreÃ§Ã£o de Provas", subheadline: 'Realize o pagamento de <strong>{price}</strong> para liberar o acesso. ApÃ³s o pagamento, retorne e dÃª permissÃ£o para o site usar sua cÃ¢mera. Aponte para as questÃµes, clique em <strong>{captureAction}</strong> e em seguida em <strong>{answerAction}</strong>.', price: 'R$ 14,90', captureAction: 'â€œClique para Corrigirâ€', answerAction: 'â€œObter Respostaâ€', paymentButton: "CLIQUE AQUI PARA PAGAR", loadingCheckout: "Aguarde, gerando checkout...", checkoutError: "Erro ao gerar link de pagamento.", paymentCheck: "Verificando seu pagamento, aguarde um instante...", paymentCheckError: "Ocorreu um problema ao verificar seu pagamento. Por favor, recarregue a pÃ¡gina." },
            "en": { pageTitle: "Get Answers for Your Test Questions!", headline: "ğŸ”’ 1-Week Access to AI Proofreader", subheadline: 'Make the payment of <strong>{price}</strong> to unlock access. After payment, return to the site and grant camera permission. Point the camera at the questions, click on <strong>{captureAction}</strong> and then on <strong>{answerAction}</strong>.', price: '$3.00 USD', captureAction: 'â€œClick to Correctâ€', answerAction: 'â€œGet Answerâ€', paymentButton: "CLICK HERE TO PAY", loadingCheckout: "Please wait, generating checkout...", checkoutError: "Error generating payment link.", paymentCheck: "Verifying your payment, please wait a moment...", paymentCheckError: "There was a problem verifying your payment. Please reload the page." },
            "es": { pageTitle: "Â¡Reciba las respuestas de las preguntas de su examen!", headline: "ğŸ”’ Acceso de 1 Semana al Corrector de Pruebas IA", subheadline: 'Realice el pago de <strong>{price}</strong> para desbloquear el acceso...', price: '$3.00 USD', captureAction: 'â€œHaga Clic para Corregirâ€', answerAction: 'â€œObtener Respuestaâ€', paymentButton: "HAGA CLIC AQUÃ PARA PAGAR", loadingCheckout: "Espere, generando checkout...", checkoutError: "Error al generar el enlace de pago.", paymentCheck: "Verificando su pago, espere un momento...", paymentCheckError: "Hubo un problema al verificar su pago. Por favor, recargue la pÃ¡gina." },
            "it": { pageTitle: "Ottieni le risposte alle domande del tuo esame!", headline: "ğŸ”’ Accesso di 1 settimana al Correttore di Bozze AI", subheadline: 'Effettua il pagamento di <strong>{price}</strong> per sbloccare l\'accesso...', price: '$3.00 USD', captureAction: 'â€œClicca per Correggereâ€', answerAction: 'â€œOttieni Rispostaâ€', paymentButton: "CLICCA QUI PER PAGARE", loadingCheckout: "Attendere, generazione checkout in corso...", checkoutError: "Errore nella generazione del link di pagamento.", paymentCheck: "Verifica del pagamento in corso, attendere prego...", paymentCheckError: "Si Ã¨ verificato un problema durante la verifica del pagamento. Si prega di ricaricare la pagina." },
            "fr": { pageTitle: "Obtenez les rÃ©ponses Ã  vos questions d'examen!", headline: "ğŸ”’ AccÃ¨s d'une semaine au correcteur IA", subheadline: 'Effectuez le paiement de <strong>{price}</strong> pour dÃ©bloquer l\'accÃ¨s...', price: '$3.00 USD', captureAction: 'Â« Cliquer pour Corriger Â»', answerAction: 'Â« Obtenir la RÃ©ponse Â»', paymentButton: "CLIQUEZ ICI POUR PAYER", loadingCheckout: "Veuillez patienter, gÃ©nÃ©ration du paiement en cours...", checkoutError: "Erreur lors de la gÃ©nÃ©ration du lien de paiement.", paymentCheck: "VÃ©rification de votre paiement, veuillez patienter un instant...", paymentCheckError: "Un problÃ¨me est survenu lors de la vÃ©rification de votre paiement. Veuillez recharger la page." },
            "ru": { pageTitle: "ĞŸĞ¾Ğ»ÑƒÑ‡Ğ¸Ñ‚Ğµ Ğ¾Ñ‚Ğ²ĞµÑ‚Ñ‹ Ğ½Ğ° Ğ²Ğ¾Ğ¿Ñ€Ğ¾ÑÑ‹ Ğ²Ğ°ÑˆĞµĞ³Ğ¾ Ñ‚ĞµÑÑ‚Ğ°!", headline: "ğŸ”’ Ğ”Ğ¾ÑÑ‚ÑƒĞ¿ Ğ½Ğ° 1 Ğ½ĞµĞ´ĞµĞ»Ñ Ğº Ğ˜Ğ˜-ĞºĞ¾Ñ€Ñ€ĞµĞºÑ‚Ğ¾Ñ€Ñƒ", subheadline: 'ĞŸÑ€Ğ¾Ğ¸Ğ·Ğ²ĞµĞ´Ğ¸Ñ‚Ğµ Ğ¾Ğ¿Ğ»Ğ°Ñ‚Ñƒ Ğ² Ñ€Ğ°Ğ·Ğ¼ĞµÑ€Ğµ <strong>{price}</strong>, Ñ‡Ñ‚Ğ¾Ğ±Ñ‹ Ñ€Ğ°Ğ·Ğ±Ğ»Ğ¾ĞºĞ¸Ñ€Ğ¾Ğ²Ğ°Ñ‚ÑŒ Ğ´Ğ¾ÑÑ‚ÑƒĞ¿...', price: '$3.00 USD', captureAction: 'Â«ĞĞ°Ğ¶Ğ¼Ğ¸Ñ‚Ğµ, Ñ‡Ñ‚Ğ¾Ğ±Ñ‹ Ğ¸ÑĞ¿Ñ€Ğ°Ğ²Ğ¸Ñ‚ÑŒÂ»', answerAction: 'Â«ĞŸĞ¾Ğ»ÑƒÑ‡Ğ¸Ñ‚ÑŒ Ğ¾Ñ‚Ğ²ĞµÑ‚Â»', paymentButton: "ĞĞĞ–ĞœĞ˜Ğ¢Ğ• Ğ—Ğ”Ğ•Ğ¡Ğ¬, Ğ§Ğ¢ĞĞ‘Ğ« ĞĞŸĞ›ĞĞ¢Ğ˜Ğ¢Ğ¬", loadingCheckout: "ĞŸĞ¾Ğ¶Ğ°Ğ»ÑƒĞ¹ÑÑ‚Ğ°, Ğ¿Ğ¾Ğ´Ğ¾Ğ¶Ğ´Ğ¸Ñ‚Ğµ, Ğ³ĞµĞ½ĞµÑ€Ğ¸Ñ€ÑƒĞµÑ‚ÑÑ ÑÑÑ‹Ğ»ĞºĞ° Ğ½Ğ° Ğ¾Ğ¿Ğ»Ğ°Ñ‚Ñƒ...", checkoutError: "ĞÑˆĞ¸Ğ±ĞºĞ° Ğ¿Ñ€Ğ¸ ÑĞ¾Ğ·Ğ´Ğ°Ğ½Ğ¸Ğ¸ ÑÑÑ‹Ğ»ĞºĞ¸ Ğ½Ğ° Ğ¾Ğ¿Ğ»Ğ°Ñ‚Ñƒ.", paymentCheck: "ĞŸÑ€Ğ¾Ğ²ĞµÑ€ÑĞµĞ¼ Ğ²Ğ°Ñˆ Ğ¿Ğ»Ğ°Ñ‚ĞµĞ¶, Ğ¿Ğ¾Ğ¶Ğ°Ğ»ÑƒĞ¹ÑÑ‚Ğ°, Ğ¿Ğ¾Ğ´Ğ¾Ğ¶Ğ´Ğ¸Ñ‚Ğµ...", paymentCheckError: "Ğ’Ğ¾Ğ·Ğ½Ğ¸ĞºĞ»Ğ° Ğ¿Ñ€Ğ¾Ğ±Ğ»ĞµĞ¼Ğ° Ğ¿Ñ€Ğ¸ Ğ¿Ñ€Ğ¾Ğ²ĞµÑ€ĞºĞµ Ğ²Ğ°ÑˆĞµĞ³Ğ¾ Ğ¿Ğ»Ğ°Ñ‚ĞµĞ¶Ğ°. ĞŸĞ¾Ğ¶Ğ°Ğ»ÑƒĞ¹ÑÑ‚Ğ°, Ğ¿ĞµÑ€ĞµĞ·Ğ°Ğ³Ñ€ÑƒĞ·Ğ¸Ñ‚Ğµ ÑÑ‚Ñ€Ğ°Ğ½Ğ¸Ñ†Ñƒ." },
            "ja": { pageTitle: "ãƒ†ã‚¹ãƒˆå•é¡Œã®ç­”ãˆã‚’æ‰‹ã«å…¥ã‚Œã‚ˆã†ï¼", headline: "ğŸ”’ AIæ ¡æ­£ãƒ„ãƒ¼ãƒ«ã¸ã®1é€±é–“ã‚¢ã‚¯ã‚»ã‚¹", subheadline: '<strong>{price}</strong> ã®ãŠæ”¯æ‰•ã„ã§ã‚¢ã‚¯ã‚»ã‚¹ã‚’è§£é™¤ã—ã¾ã™ã€‚...', price: '$3.00 USD', captureAction: 'ã€Œã‚¯ãƒªãƒƒã‚¯ã—ã¦ä¿®æ­£ã€', answerAction: 'ã€Œå›ç­”ã‚’å¾—ã‚‹ã€', paymentButton: "ã“ã“ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¦æ”¯æ‰•ã†", loadingCheckout: "ãŠå¾…ã¡ãã ã•ã„ã€ãƒã‚§ãƒƒã‚¯ã‚¢ã‚¦ãƒˆã‚’ç”Ÿæˆä¸­ã§ã™...", checkoutError: "æ”¯æ‰•ã„ãƒªãƒ³ã‚¯ã®ç”Ÿæˆä¸­ã«ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸã€‚", paymentCheck: "ãŠæ”¯æ‰•ã„ã‚’ç¢ºèªã—ã¦ã„ã¾ã™ã€ã—ã°ã‚‰ããŠå¾…ã¡ãã ã•ã„...", paymentCheckError: "ãŠæ”¯æ‰•ã„ã®ç¢ºèªä¸­ã«å•é¡ŒãŒç™ºç”Ÿã—ã¾ã—ãŸã€‚ãƒšãƒ¼ã‚¸ã‚’å†èª­ã¿è¾¼ã¿ã—ã¦ãã ã•ã„ã€‚" },
            "ko": { pageTitle: "ì‹œí—˜ ë¬¸ì œì˜ ë‹µì„ ì–»ìœ¼ì„¸ìš”!", headline: "ğŸ”’ AI êµì •ê¸° 1ì£¼ì¼ ì´ìš©ê¶Œ", subheadline: '<strong>{price}</strong>ë¥¼ ê²°ì œí•˜ì—¬ ì•¡ì„¸ìŠ¤ë¥¼ ì ê¸ˆ í•´ì œí•˜ì„¸ìš”...', price: '$3.00 USD', captureAction: 'â€œí´ë¦­í•˜ì—¬ ìˆ˜ì •â€', answerAction: 'â€œë‹µë³€ ì–»ê¸°â€', paymentButton: "ê²°ì œí•˜ë ¤ë©´ ì—¬ê¸°ë¥¼ í´ë¦­í•˜ì„¸ìš”", loadingCheckout: "ì ì‹œë§Œ ê¸°ë‹¤ë ¤ì£¼ì„¸ìš”, ê²°ì œ ì°½ì„ ìƒì„± ì¤‘ì…ë‹ˆë‹¤...", checkoutError: "ê²°ì œ ë§í¬ ìƒì„± ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.", paymentCheck: "ê²°ì œë¥¼ í™•ì¸ ì¤‘ì…ë‹ˆë‹¤, ì ì‹œë§Œ ê¸°ë‹¤ë ¤ì£¼ì„¸ìš”...", paymentCheckError: "ê²°ì œ í™•ì¸ ì¤‘ ë¬¸ì œê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤. í˜ì´ì§€ë¥¼ ìƒˆë¡œê³ ì¹¨í•´ ì£¼ì„¸ìš”." },
            "zh": { pageTitle: "è·å–æ‚¨çš„æµ‹è¯•é¢˜ç­”æ¡ˆï¼", headline: "ğŸ”’ äººå·¥æ™ºèƒ½æ ¡å¯¹å™¨1å‘¨ä½¿ç”¨æƒ", subheadline: 'æ”¯ä»˜<strong>{price}</strong>ä»¥è§£é”è®¿é—®æƒé™ã€‚...', price: '$3.00 USD', captureAction: 'â€œç‚¹å‡»ä»¥æ›´æ­£â€', answerAction: 'â€œè·å–ç­”æ¡ˆâ€', paymentButton: "ç‚¹å‡»æ­¤å¤„ä»˜æ¬¾", loadingCheckout: "è¯·ç¨å€™ï¼Œæ­£åœ¨ç”Ÿæˆç»“è´¦...", checkoutError: "ç”Ÿæˆæ”¯ä»˜é“¾æ¥æ—¶å‡ºé”™ã€‚", paymentCheck: "æ­£åœ¨éªŒè¯æ‚¨çš„ä»˜æ¬¾ï¼Œè¯·ç¨ç­‰...", paymentCheckError: "éªŒè¯æ‚¨çš„ä»˜æ¬¾æ—¶å‡ºç°é—®é¢˜ã€‚è¯·é‡æ–°åŠ è½½é¡µé¢ã€‚" }
        };

        function setLanguage(langCode, priceText) {
            document.documentElement.lang = langCode;
            const dictionary = translations[langCode] || translations['en'];
            document.querySelectorAll('[data-i18n]').forEach(element => {
                const key = element.getAttribute('data-i18n');
                let text = dictionary[key] || `[${key}]`;
                if (key === 'subheadline') { text = text.replace('{price}', priceText).replace('{captureAction}', dictionary.captureAction).replace('{answerAction}', dictionary.answerAction); }
                if (element.tagName === 'TITLE' || element.tagName === 'STRONG') { element.textContent = text; } 
                else { element.innerHTML = text; }
            });
        }
        
        function main() {
            try {
                document.body.classList.remove('hidden-on-load');
                
                const APP_PAGE = "/app.html";
                function getSessionId() { let sid = localStorage.getItem("mp_session_id"); if (!sid) { sid = crypto.randomUUID(); localStorage.setItem("mp_session_id", sid); } return sid; }
                function hasValidAccess() { const t = localStorage.getItem('accessToken'); if (!t) return false; try { return Date.now() < JSON.parse(t).expiry; } catch (e) { return false; } }
                function setAccessAndRedirect() { const expiry = Date.now() + 604800000; localStorage.setItem("accessToken", JSON.stringify({ expiry })); window.location.href = APP_PAGE; }

                if (hasValidAccess()) {
                    window.location.href = APP_PAGE;
                    return;
                }

                const userLanguage = (navigator.language || navigator.userLanguage).toLowerCase();
                const isBrazilianPortuguese = userLanguage.startsWith('pt');
                const currency = isBrazilianPortuguese ? 'BRL' : 'USD';
                const langCode = isBrazilianPortuguese ? 'pt-br' : 'en';
                const dictionary = translations[langCode] || translations['en'];
                
                setLanguage(langCode, dictionary.price);

                document.getElementById('start-btn').addEventListener('click', async () => {
                    const btn = document.getElementById('start-btn');
                    btn.disabled = true;
                    btn.textContent = dictionary.loadingCheckout;
                    
                    const payload = { sessionId: getSessionId(), email: "cliente@email.com", currency };

                    // --- PONTO DE DEPURAÃ‡ÃƒO NO FRONTEND ---
                    console.log("Payload que serÃ¡ enviado para o backend:", payload);
                    alert(`DEPURAÃ‡ÃƒO: A moeda detectada e enviada Ã©: ${currency}`);
                    // ----------------------------------------

                    try {
                        const res = await fetch("/api/create-payment", { method: "POST", headers: { "Content-Type": "application/json" }, body: JSON.stringify(payload) });
                        if (!res.ok) { const err = await res.json(); throw new Error(err.details || dictionary.checkoutError); }
                        const data = await res.json();
                        window.location.href = data.checkoutUrl;
                    } catch (error) {
                        alert(error.message);
                        btn.disabled = false;
                        btn.textContent = dictionary.paymentButton;
                    }
                });

                const urlParams = new URLSearchParams(window.location.search);
                if (urlParams.has('success')) {
                    const welcomeView = document.getElementById('welcome-view');
                    welcomeView.innerHTML = `<h2>${dictionary.paymentCheck}</h2>`;
                    let attempts = 0;
                    const checkInterval = setInterval(async () => {
                        if (++attempts > 10) { clearInterval(checkInterval); welcomeView.innerHTML = `<h2>${dictionary.paymentCheckError}</h2>`; return; }
                        try {
                            const r = await fetch(`/api/check-status?sessionId=${getSessionId()}`);
                            if (r.ok) { const j = await r.json(); if (j.paid) { clearInterval(checkInterval); setAccessAndRedirect(); } }
                        } catch(e) { console.error("Erro na verificaÃ§Ã£o, tentando novamente..."); }
                    }, 3000);
                }
            } catch (error) {
                console.error("Erro crÃ­tico:", error);
                document.body.classList.remove('hidden-on-load');
                document.body.innerHTML = `<div style="color: white; padding: 20px; text-align: center;"><h1>Erro ao carregar</h1><p>${error.message}</p></div>`;
            }
        }

        main();
    </script>
</body>
</html>
